---
layout: post

title: docker新手入门的简单命令1
---
最近做数值计算，接触第一次接触Docker，入手后发现是很便利的神器。下载到电脑里的Docker可被看做一个展开的平面，可以在上面进行配置软件和各种文件，形成一个个镜像（image）,配置完毕，可以把平面折叠打包，丢到另一台电脑上运行。一个巨大的优势是，即使另一台电脑并未安装运行代码所需的软件，Docker中的镜像依然正常运行，所以Docker又被看做虚拟机。

说说最重要的最核心的概念，镜像吧。首先要有一个**Dockerfile.txt**，长这样：

> FROM python-cplex:latest #导入基础（已有）镜像 python-cplex:latest
> 
> RUN apt-get update && apt-get install -y python-pip && pip2 install pyomo #安装python的包pyomo，用RUN命令
> 
> ADD model.py / #加入文件，如果是压缩文件，用COPY
> 
> CMD [ "python2.7", "./model.py" ]  #call需要的软件和运行的文件， 用CMD命令

在终端打开到Dockerfile所在的路径，开始建立镜像，比方说命名为test：

`docker build -t test .`

输入命令：`docker images`, 可以看到test:latest这个镜像，打开test, `docker run -i -t test /bib/bash`, 可以查看到已经导入的文件，命令是`ls`。如果要直接运行该镜像，则`docker run -i -t test`

每次运行镜像，会产生一个container, 编号一般是长串数字乱码。
`docker ps` 可查看正在运行的container, `docker ps -a` 查看所有的container. 对于不需要的container, 可以 `docker rm container_code`删除， 停止一个container, 用`docker stop container_code`, 不需要image， 可以 `docker rmi image_name`删掉。

以上操作足够完成测试Docker是否成功在电脑上运行了。但现实情况是，model.py这个程序或许不只是python2.7就可以直接求解的，可能还需要solver, 比如gurobi, cplex. 如何在Docker里面安装CPLEX呢？以安装包cplex_studio12.7.1.linux-x86-64.bin为例,MAC：

首先使用以下命令把安装包复制到Docker（也可以使用Dockerfile):
`docker run -i -t test1 /bin/bash` #建立新的镜像
`scp -rp username@IPAddress:current directory/cplex_studio12.7.1.linux-x86-64.bin .` #在该镜像下，将安装包复制进去

如果connection refused, 打开设置,找到sharing打开remote login,记得用完关闭。

开始在shell下安装bin文件，命令如下：
`chmod a+x ./cplex_studio12.7.1.linux-x86-64.bin`
`./cplex_studio12.7.1.linux-x86-64.bin`
如果没有解压包，则输入以下命令：
`apt-get update && apt-get install upzip`
然后再次输入 `./cplex_studio12.7.1.linux-x86-64.bin`
一路回车吧，最后看到installing,过一两分钟cplex就装好了，大功告成！
其他的软件也可以类似安装。test1这个镜像可以作为基础镜像，去创建新的包含cplex的镜像。但记住用docker commit另建镜像，不然基础镜像就被覆盖了。


下一篇会梳理下更多的docker的基本操作。







